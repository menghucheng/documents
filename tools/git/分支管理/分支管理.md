# Git 分支管理

## 1. 分支概述

分支是 Git 中用于并行开发的核心功能，允许你在不影响主分支的情况下开发新功能或修复bug。

## 2. 查看分支

### 2.1 `git branch`

查看本地分支列表。

**语法：**
```bash
$ git branch
```

**输出示例：**
```
  feature-branch
* main
  bugfix-branch
```

**常用选项：**
- `-a` 或 `--all`：显示所有分支，包括本地分支和远程分支
- `-r` 或 `--remote`：仅显示远程分支
- `-v` 或 `--verbose`：显示分支的最近提交信息
- `--merged`：显示已合并到当前分支的分支
- `--no-merged`：显示未合并到当前分支的分支

**示例：**
```bash
$ git branch -a
  feature-branch
* main
  bugfix-branch
  remotes/origin/main
  remotes/origin/feature-branch
```

## 3. 创建分支

### 3.1 `git branch`

创建新分支，但不切换到新分支。

**语法：**
```bash
$ git branch <分支名>
```

**示例：**
```bash
$ git branch feature-login
```

## 4. 切换分支

### 4.1 `git checkout`

切换到指定分支。

**语法：**
```bash
$ git checkout <分支名>
```

**示例：**
```bash
$ git checkout feature-login
```

**输出示例：**
```
Switched to branch 'feature-login'
```

### 4.2 `git checkout -b`

创建新分支并立即切换到新分支。

**语法：**
```bash
$ git checkout -b <分支名>
```

**示例：**
```bash
$ git checkout -b feature-register
```

**输出示例：**
```
Switched to a new branch 'feature-register'
```

### 4.3 `git switch`（Git 2.23+）

Git 2.23 引入了 `switch` 命令，用于更直观地切换分支。

**语法：**
```bash
$ git switch <分支名>
```

**示例：**
```bash
$ git switch main
```

**输出示例：**
```
Switched to branch 'main'
```

### 4.4 `git switch -c`（Git 2.23+）

创建新分支并立即切换到新分支。

**语法：**
```bash
$ git switch -c <分支名>
```

**示例：**
```bash
$ git switch -c feature-dashboard
```

**输出示例：**
```
Switched to a new branch 'feature-dashboard'
```

## 5. 合并分支

### 5.1 `git merge`

将指定分支的修改合并到当前分支。

**语法：**
```bash
$ git merge <分支名>
```

**常用场景：**

1. **Fast-forward 合并**：如果当前分支是要合并分支的直接祖先，Git 会执行快进合并，只移动指针。

   **示例：**
   ```bash
   $ git checkout main
   $ git merge feature-login
   ```

   **输出示例：**
   ```
   Updating 1a2b3c4..5d6e7f8
   Fast-forward
    login.js | 100 ++++++++++++++++++++++++++++++++++++++++++++++++++
    1 file changed, 100 insertions(+)
    create mode 100644 login.js
   ```

2. **递归合并**：如果当前分支不是要合并分支的直接祖先，Git 会创建一个新的合并提交。

   **示例：**
   ```bash
   $ git checkout main
   $ git merge feature-register
   ```

   **输出示例：**
   ```
   Merge made by the 'ort' strategy.
    register.js | 50 +++++++++++++++++++++++++++++++
    1 file changed, 50 insertions(+)
    create mode 100644 register.js
   ```

**常用选项：**
- `--no-ff`：强制创建合并提交，即使是快进合并
- `--squash`：将指定分支的所有提交压缩为一个提交
- `--abort`：中止合并，恢复到合并前的状态

**示例：**
```bash
$ git merge --no-ff feature-login
```

### 5.2 解决合并冲突

当合并时，两个分支对同一文件的同一部分进行了不同修改，Git 会产生冲突。

**冲突示例：**
```
<<<<<<< HEAD
console.log("Hello from main branch");
=======
console.log("Hello from feature branch");
>>>>>>> feature-branch
```

**解决步骤：**

1. 查看冲突文件：
```bash
$ git status
```

2. 编辑冲突文件，手动解决冲突：
```javascript
console.log("Hello from merged branch");
```

3. 将解决后的文件添加到暂存区：
```bash
$ git add conflict-file.js
```

4. 完成合并提交：
```bash
$ git commit -m "Resolve merge conflict"
```

## 6. 删除分支

### 6.1 `git branch -d`

删除已合并的分支。

**语法：**
```bash
$ git branch -d <分支名>
```

**示例：**
```bash
$ git branch -d feature-login
```

**输出示例：**
```
Deleted branch feature-login (was 5d6e7f8).
```

### 6.2 `git branch -D`

强制删除未合并的分支。

**语法：**
```bash
$ git branch -D <分支名>
```

**示例：**
```bash
$ git branch -D feature-unfinished
```

**输出示例：**
```
Deleted branch feature-unfinished (was 9a8b7c6).
```

## 7. 分支管理策略

### 7.1 常见分支策略

#### 7.1.1 Git Flow

Git Flow 是一种流行的分支管理策略，包含以下分支类型：

- **master/main**：稳定版本分支，用于发布
- **develop**：开发分支，整合所有功能分支
- **feature/\***：功能分支，从 develop 分支创建，完成后合并回 develop
- **release/\***：发布分支，从 develop 分支创建，用于准备发布
- **hotfix/\***：热修复分支，从 master 分支创建，用于修复生产环境的bug

#### 7.1.2 GitHub Flow

GitHub Flow 是一种简化的分支管理策略：

1. 从 main 分支创建功能分支
2. 在功能分支上进行开发
3. 提交 Pull Request
4. 代码审查
5. 合并到 main 分支
6. 部署

#### 7.1.3 GitLab Flow

GitLab Flow 结合了 Git Flow 和 GitHub Flow 的优点，强调持续部署：

- **环境分支**：如 staging、production
- **功能分支**：用于开发新功能
- **发布分支**：用于版本发布

## 8. 高级分支操作

### 8.1 重命名分支

**语法：**
```bash
$ git branch -m <旧分支名> <新分支名>
```

**示例：**
```bash
$ git branch -m feature-old feature-new
```

### 8.2 查看分支图

**语法：**
```bash
$ git log --oneline --graph --decorate --all
```

**输出示例：**
```
*   7a8b9c0 (HEAD -> main) Merge branch 'feature-register'
|\  
| * 5d6e7f8 (feature-register) Add register functionality
| * 4g5h6i7 Add register form
* | 3j4k5l6 Update README
|/  
* 2m3n4o5 (tag: v1.0.0) Initial release
* 1a2b3c4 Initial commit
```

### 8.3 储藏分支（Stash）

#### 8.3.1 `git stash`

储藏当前工作目录的修改，以便切换到其他分支。

**语法：**
```bash
$ git stash
```

**输出示例：**
```
Saved working directory and index state WIP on main: 1a2b3c4 Initial commit
```

#### 8.3.2 `git stash list`

查看储藏列表。

**语法：**
```bash
$ git stash list
```

**输出示例：**
```
stash@{0}: WIP on main: 1a2b3c4 Initial commit
stash@{1}: WIP on feature-branch: 5d6e7f8 Add new feature
```

#### 8.3.3 `git stash apply`

应用储藏的修改。

**语法：**
```bash
$ git stash apply <储藏名>
```

**示例：**
```bash
$ git stash apply stash@{0}
```

#### 8.3.4 `git stash pop`

应用储藏的修改并删除储藏。

**语法：**
```bash
$ git stash pop <储藏名>
```

**示例：**
```bash
$ git stash pop
```

#### 8.3.5 `git stash drop`

删除储藏。

**语法：**
```bash
$ git stash drop <储藏名>
```

**示例：**
```bash
$ git stash drop stash@{0}
```

#### 8.3.6 `git stash clear`

删除所有储藏。

**语法：**
```bash
$ git stash clear
```

## 9. 分支管理最佳实践

1. **频繁创建分支**：每个新功能或bug修复都应该有自己的分支
2. **分支命名规范**：使用有意义的分支名，如 `feature-login`、`bugfix-123`
3. **定期合并主线代码**：保持功能分支与主线分支同步
4. **及时删除无用分支**：合并后删除不再需要的分支
5. **使用 Pull Request**：进行代码审查，确保代码质量
6. **遵循团队分支策略**：统一团队的分支管理规范
