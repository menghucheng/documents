# CSS 动画与过渡

## 1. 过渡（Transition）

CSS过渡允许元素的样式在一定时间内平滑地从一种状态变化到另一种状态，而不是瞬间改变。

### 1.1 过渡工作流程示意图

```
┌────────────────────────────────────────────────────────────────────┐
│                        CSS 过渡工作流程                           │
├────────────────────────────────────────────────────────────────────┤
│  1. 初始状态：元素应用初始样式                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  .element { width: 100px; transition: width 0.3s ease; }     │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  2. 触发条件：用户交互或JS改变元素状态                               │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  .element:hover { width: 200px; }                           │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  3. 过渡开始：应用transition属性，开始平滑过渡                        │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  时间：0s → 0.3s                                            │  │
│  │  宽度：100px → 200px                                        │  │
│  │  速度曲线：ease（慢 → 快 → 慢）                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  4. 过渡结束：元素达到最终状态                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  宽度：200px（最终状态）                                     │  │
│  └──────────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────────┘
```

### 1.2 transition 属性

`transition`属性是一个简写属性，用于同时设置以下四个过渡属性：

- `transition-property`：指定要过渡的CSS属性
- `transition-duration`：指定过渡的持续时间
- `transition-timing-function`：指定过渡的时间函数
- `transition-delay`：指定过渡开始之前的延迟时间

```css
/* 简写语法 */
.element {
  transition: all 0.3s ease 0s;
}

/* 分别设置各个属性 */
.element {
  transition-property: all;
  transition-duration: 0.3s;
  transition-timing-function: ease;
  transition-delay: 0s;
}
```

### 1.2 transition-property

`transition-property`属性指定哪些CSS属性将应用过渡效果。

```css
/* 过渡单个属性 */
.element {
  transition-property: width;
}

/* 过渡多个属性 */
.element {
  transition-property: width, height, background-color;
}

/* 过渡所有可过渡的属性 */
.element {
  transition-property: all;
}
```

### 1.3 transition-duration

`transition-duration`属性指定过渡效果的持续时间，单位可以是秒（s）或毫秒（ms）。

```css
/* 持续时间为0.3秒 */
.element {
  transition-duration: 0.3s;
}

/* 持续时间为500毫秒 */
.element {
  transition-duration: 500ms;
}
```

### 1.4 transition-timing-function

`transition-timing-function`属性指定过渡效果的时间函数，控制过渡的速度变化。

#### 时间函数曲线示意图

```
┌────────────────────────────────────────────────────────────────────┐
│                     时间函数曲线示意图                             │
├────────────────────────────────────────────────────────────────────┤
│  速度                                                               │
│  ────────────────────────────────────────────────────────────────  │
│    │                                                               │
│    │        ease-in-out                    ease-in                  │
│    │           ┌─────┐                     ┌─────┐                 │
│    │          /       \                   /       \                │
│    │         /         \                 /         \               │
│    │        /           \               /           \              │
│    │       /             \             /             \             │
│    │      /               \           /               \            │
│    │ ease /                 \ ease-out/                 \          │
│    │─────┘                   └───────┘                   \         │
│    │                                                      \        │
│    │                                                       \       │
│    │                                                        \      │
│    │                                                         \     │
│    │                                                          \    │
│    │                                                           \   │
│    │                                                            \  │
│    │                                                             \ │
│    │                                                              \│
│    └───────────────────────────────────────────────────────────────│
│                        时间（0% → 100%）                          │
└────────────────────────────────────────────────────────────────────┘

时间函数特点说明：
- `linear`：匀速直线运动
- `ease`：慢 → 快 → 慢（默认）
- `ease-in`：慢 → 快
- `ease-out`：快 → 慢
- `ease-in-out`：慢 → 快 → 慢（更平滑）
- `cubic-bezier(n,n,n,n)`：自定义贝塞尔曲线，可创建各种速度变化
```

```css
/* 使用预定义的时间函数 */
.element {
  transition-timing-function: ease-in-out;
}

/* 使用自定义贝塞尔曲线 */
.element {
  transition-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);
}
```

### 1.5 transition-delay

`transition-delay`属性指定过渡效果开始之前的延迟时间，单位可以是秒（s）或毫秒（ms）。

```css
/* 延迟0.2秒 */
.element {
  transition-delay: 0.2s;
}
```

### 1.6 过渡示例

```html
<div class="box">Hover me</div>
```

```css
.box {
  width: 100px;
  height: 100px;
  background-color: blue;
  color: white;
  text-align: center;
  line-height: 100px;
  transition: all 0.3s ease;
}

.box:hover {
  width: 200px;
  height: 200px;
  background-color: red;
  transform: rotate(45deg);
}
```

## 2. 动画（Animation）

CSS动画允许元素在一定时间内经历一系列样式变化，比过渡更强大，可以实现更复杂的动画效果。

### 2.1 @keyframes 规则

`@keyframes`规则用于定义动画序列，指定元素在不同时间点的样式。

```css
@keyframes example {
  from {
    background-color: blue;
  }
  to {
    background-color: red;
  }
}

/* 使用百分比 */
@keyframes example {
  0% {
    background-color: blue;
    transform: scale(1);
  }
  50% {
    background-color: green;
    transform: scale(1.5);
  }
  100% {
    background-color: red;
    transform: scale(1);
  }
}
```

### 2.2 animation 属性

`animation`属性是一个简写属性，用于同时设置以下八个动画属性：

- `animation-name`：指定要使用的@keyframes规则
- `animation-duration`：指定动画的持续时间
- `animation-timing-function`：指定动画的时间函数
- `animation-delay`：指定动画开始之前的延迟时间
- `animation-iteration-count`：指定动画的播放次数
- `animation-direction`：指定动画的播放方向
- `animation-fill-mode`：指定动画结束后元素的样式
- `animation-play-state`：指定动画的播放状态

```css
/* 简写语法 */
.element {
  animation: example 2s ease 0s infinite alternate both running;
}

/* 分别设置各个属性 */
.element {
  animation-name: example;
  animation-duration: 2s;
  animation-timing-function: ease;
  animation-delay: 0s;
  animation-iteration-count: infinite;
  animation-direction: alternate;
  animation-fill-mode: both;
  animation-play-state: running;
}
```

### 2.3 animation-name

`animation-name`属性指定要使用的@keyframes规则名称。

```css
.element {
  animation-name: example;
}
```

### 2.4 animation-duration

`animation-duration`属性指定动画的持续时间，单位可以是秒（s）或毫秒（ms）。

```css
.element {
  animation-duration: 2s;
}
```

### 2.5 animation-timing-function

`animation-timing-function`属性指定动画的时间函数，与`transition-timing-function`相同。

```css
.element {
  animation-timing-function: ease-in-out;
}
```

### 2.6 animation-delay

`animation-delay`属性指定动画开始之前的延迟时间，单位可以是秒（s）或毫秒（ms）。

```css
.element {
  animation-delay: 0.5s;
}
```

### 2.7 animation-iteration-count

`animation-iteration-count`属性指定动画的播放次数。

```css
/* 播放一次 */
.element {
  animation-iteration-count: 1;
}

/* 播放三次 */
.element {
  animation-iteration-count: 3;
}

/* 无限循环播放 */
.element {
  animation-iteration-count: infinite;
}
```

### 2.8 animation-direction

`animation-direction`属性指定动画的播放方向。

```css
/* 正常播放（默认） */
.element {
  animation-direction: normal;
}

/* 反向播放 */
.element {
  animation-direction: reverse;
}

/* 交替播放，奇数次正常，偶数次反向 */
.element {
  animation-direction: alternate;
}

/* 反向交替播放，奇数次反向，偶数次正常 */
.element {
  animation-direction: alternate-reverse;
}
```

### 2.9 animation-fill-mode

`animation-fill-mode`属性指定动画结束后元素的样式。

```css
/* 不改变任何样式（默认） */
.element {
  animation-fill-mode: none;
}

/* 保持动画结束时的样式 */
.element {
  animation-fill-mode: forwards;
}

/* 保持动画开始时的样式 */
.element {
  animation-fill-mode: backwards;
}

/* 同时应用forwards和backwards的效果 */
.element {
  animation-fill-mode: both;
}
```

### 2.10 animation-play-state

`animation-play-state`属性指定动画的播放状态。

```css
/* 播放动画（默认） */
.element {
  animation-play-state: running;
}

/* 暂停动画 */
.element {
  animation-play-state: paused;
}
```

### 2.11 动画示例

#### 2.11.1 旋转动画

```html
<div class="box">Rotating Box</div>
```

```css
@keyframes rotate {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.box {
  width: 100px;
  height: 100px;
  background-color: blue;
  color: white;
  text-align: center;
  line-height: 100px;
  animation: rotate 2s linear infinite;
}
```

#### 2.11.2 弹跳动画

```html
<div class="box">Bouncing Box</div>
```

```css
@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-30px);
  }
  60% {
    transform: translateY(-15px);
  }
}

.box {
  width: 100px;
  height: 100px;
  background-color: blue;
  color: white;
  text-align: center;
  line-height: 100px;
  animation: bounce 2s ease infinite;
}
```

#### 2.11.3 淡入淡出动画

```html
<div class="box">Fading Box</div>
```

```css
@keyframes fade {
  0% {
    opacity: 0;
  }
  50% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}

.box {
  width: 100px;
  height: 100px;
  background-color: blue;
  color: white;
  text-align: center;
  line-height: 100px;
  animation: fade 3s ease infinite;
}
```

## 3. 变换（Transform）

CSS变换允许元素进行平移、旋转、缩放和倾斜等操作，通常与过渡和动画结合使用，创建更丰富的视觉效果。

### 3.1 transform 属性

`transform`属性用于指定元素的变换效果。

```css
/* 单个变换 */
.element {
  transform: rotate(45deg);
}

/* 多个变换，按顺序应用 */
.element {
  transform: translate(50px, 50px) rotate(45deg) scale(1.5);
}
```

### 3.2 2D 变换

#### 3.2.1 translate()

`translate()`函数用于平移元素，接受两个参数，分别是水平和垂直方向的平移距离。

```css
/* 同时指定水平和垂直方向的平移 */
.element {
  transform: translate(50px, 50px);
}

/* 只指定水平方向的平移 */
.element {
  transform: translateX(50px);
}

/* 只指定垂直方向的平移 */
.element {
  transform: translateY(50px);
}
```

#### 3.2.2 rotate()

`rotate()`函数用于旋转元素，参数是旋转的角度，单位可以是度（deg）、弧度（rad）或圈（turn）。

```css
/* 顺时针旋转45度 */
.element {
  transform: rotate(45deg);
}

/* 逆时针旋转45度 */
.element {
  transform: rotate(-45deg);
}

/* 旋转180度 */
.element {
  transform: rotate(180deg);
}

/* 旋转一圈 */
.element {
  transform: rotate(1turn);
}
```

#### 3.2.3 scale()

`scale()`函数用于缩放元素，接受两个参数，分别是水平和垂直方向的缩放比例。

```css
/* 同时指定水平和垂直方向的缩放 */
.element {
  transform: scale(1.5, 2);
}

/* 只指定水平方向的缩放 */
.element {
  transform: scaleX(1.5);
}

/* 只指定垂直方向的缩放 */
.element {
  transform: scaleY(2);
}

/* 水平翻转元素 */
.element {
  transform: scaleX(-1);
}

/* 垂直翻转元素 */
.element {
  transform: scaleY(-1);
}
```

#### 3.2.4 skew()

`skew()`函数用于倾斜元素，接受两个参数，分别是水平和垂直方向的倾斜角度。

```css
/* 同时指定水平和垂直方向的倾斜 */
.element {
  transform: skew(30deg, 20deg);
}

/* 只指定水平方向的倾斜 */
.element {
  transform: skewX(30deg);
}

/* 只指定垂直方向的倾斜 */
.element {
  transform: skewY(20deg);
}
```

#### 3.2.5 matrix()

`matrix()`函数是一个复合变换函数，接受六个参数，用于组合平移、旋转、缩放和倾斜效果。

```css
.element {
  transform: matrix(1, 0, 0, 1, 50, 50);
}
```

### 3.3 3D 变换

CSS3引入了3D变换，允许元素在3D空间中进行变换。

#### 3.3.1 transform-style

`transform-style`属性指定元素的子元素是否应该在3D空间中渲染。

```css
/* 2D空间（默认） */
.element {
  transform-style: flat;
}

/* 3D空间 */
.element {
  transform-style: preserve-3d;
}
```

#### 3.3.2 perspective

`perspective`属性指定3D元素的透视效果，定义了观察者与z=0平面的距离。

```css
/* 在父元素上设置透视 */
.parent {
  perspective: 1000px;
}

/* 在元素自身上设置透视 */
.element {
  perspective: 1000px;
}

/* 使用perspective()函数 */
.element {
  transform: perspective(1000px) rotateX(45deg);
}
```

#### 3.3.3 rotateX(), rotateY(), rotateZ()

这些函数用于在3D空间中旋转元素。

```css
/* 绕X轴旋转 */
.element {
  transform: rotateX(45deg);
}

/* 绕Y轴旋转 */
.element {
  transform: rotateY(45deg);
}

/* 绕Z轴旋转 */
.element {
  transform: rotateZ(45deg);
}

/* 绕自定义轴旋转 */
.element {
  transform: rotate3d(1, 1, 1, 45deg);
}
```

#### 3.3.4 translateZ()

`translateZ()`函数用于在3D空间中沿Z轴平移元素。

```css
/* 沿Z轴正向平移 */
.element {
  transform: translateZ(100px);
}

/* 沿Z轴反向平移 */
.element {
  transform: translateZ(-100px);
}

/* 3D平移 */
.element {
  transform: translate3d(50px, 50px, 100px);
}
```

#### 3.3.5 scaleZ()

`scaleZ()`函数用于在3D空间中沿Z轴缩放元素。

```css
/* 沿Z轴缩放 */
.element {
  transform: scaleZ(2);
}

/* 3D缩放 */
.element {
  transform: scale3d(1.5, 1.5, 2);
}
```

#### 3.3.6 matrix3d()

`matrix3d()`函数是3D变换的复合变换函数，接受16个参数。

```css
.element {
  transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 50, 50, 0, 1);
}
```

### 3.4 transform-origin

`transform-origin`属性指定变换的原点，默认值是元素的中心（50% 50%）。

```css
/* 使用关键字 */
.element {
  transform-origin: top left;
}

/* 使用百分比 */
.element {
  transform-origin: 0% 0%;
}

/* 使用具体数值 */
.element {
  transform-origin: 10px 20px;
}

/* 3D变换的原点 */
.element {
  transform-origin: 50% 50% 100px;
}
```

## 4. 过渡与动画的区别

| 特性 | 过渡（Transition） | 动画（Animation） |
|------|-------------------|-------------------|
| 触发方式 | 需要状态变化（如:hover, :focus等） | 自动触发或通过JavaScript控制 |
| 动画序列 | 只能定义开始和结束两个状态 | 可以定义多个关键帧，实现更复杂的动画 |
| 播放次数 | 只能播放一次 | 可以播放多次或无限循环 |
| 控制方式 | 简单，只能开始和结束 | 可以暂停、播放、反向播放等 |
| 性能 | 性能较好 | 性能相对较低，复杂动画可能影响性能 |

## 5. 性能优化

### 5.1 使用GPU加速

某些CSS属性可以触发GPU加速，提高动画性能：

- `transform`
- `opacity`
- `filter`

### 5.2 避免使用昂贵的属性

以下属性会导致重排或重绘，应尽量避免在动画中使用：

- `width`
- `height`
- `margin`
- `padding`
- `border`
- `background-color`
- `color`

### 5.3 使用will-change属性

`will-change`属性可以提前通知浏览器元素将要发生的变化，让浏览器提前做好准备，提高动画性能。

```css
.element {
  will-change: transform, opacity;
}
```

### 5.4 合理使用动画

- 避免同时运行过多动画
- 控制动画的持续时间，避免过长的动画
- 使用合适的时间函数，避免过于复杂的贝塞尔曲线

## 6. 浏览器兼容性

| 特性 | IE | Chrome | Firefox | Safari | Edge |
|------|----|--------|---------|--------|------|
| 过渡 | 10+ | 26+ | 16+ | 6.1+ | 12+ |
| 动画 | 10+ | 43+ | 16+ | 9+ | 12+ |
| 2D变换 | 9+ | 36+ | 16+ | 6.1+ | 12+ |
| 3D变换 | 11+ | 36+ | 16+ | 9+ | 12+ |

### 6.1 兼容性解决方案

1. **使用CSS前缀**：对于一些旧版浏览器，需要使用厂商前缀，如`-webkit-`、`-moz-`、`-ms-`等。
2. **提供降级方案**：为不支持动画和过渡的浏览器提供基本样式。
3. **使用JavaScript polyfill**：对于一些不支持的特性，可以使用JavaScript polyfill。
4. **使用CSS预处理器**：如Sass、Less等，可以自动处理兼容性问题。

## 7. 最佳实践

### 7.1 保持动画简洁

- 避免使用过于复杂的动画
- 保持动画的持续时间合理
- 使用合适的时间函数

### 7.2 优先使用过渡

对于简单的状态变化，优先使用过渡，而不是动画，因为过渡性能更好，代码更简洁。

### 7.3 合理使用3D变换

3D变换虽然可以创建更丰富的视觉效果，但会消耗更多的性能，应谨慎使用。

### 7.4 测试不同设备

- 在不同设备上测试动画性能
- 考虑移动设备的性能限制
- 使用浏览器开发者工具分析动画性能

### 7.5 遵循设计原则

- 保持动画的一致性
- 动画应服务于用户体验，而不是为了动画而动画
- 避免过度使用动画，以免分散用户注意力

## 8. 动画库

除了使用原生CSS动画和过渡外，还可以使用一些优秀的动画库，如：

- **Animate.css**：一个强大的跨浏览器动画库，提供了大量预设动画。
- **GreenSock Animation Platform (GSAP)**：一个高性能的JavaScript动画库，支持复杂的动画效果。
- **Velocity.js**：一个轻量级的JavaScript动画库，性能接近原生CSS动画。
- **Framer Motion**：一个基于React的动画库，提供了声明式的动画API。
- **Lottie**：一个用于渲染After Effects动画的库，可以直接在网页中播放After Effects动画。

## 9. 实例应用

### 9.1 悬停效果

```html
<button class="btn">Hover Me</button>
```

```css
.btn {
  padding: 10px 20px;
  background-color: blue;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn:hover {
  background-color: darkblue;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}
```

### 9.2 加载动画

```html
<div class="loader"></div>
```

```css
.loader {
  width: 50px;
  height: 50px;
  border: 5px solid #f3f3f3;
  border-top: 5px solid blue;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
```

### 9.3 滚动动画

```html
<div class="scroll-animation">Scroll to see animation</div>
```

```css
.scroll-animation {
  opacity: 0;
  transform: translateY(50px);
  transition: all 0.5s ease;
}

.scroll-animation.visible {
  opacity: 1;
  transform: translateY(0);
}
```

```javascript
// 使用JavaScript监听滚动事件
window.addEventListener('scroll', () => {
  const elements = document.querySelectorAll('.scroll-animation');
  elements.forEach(element => {
    const elementTop = element.getBoundingClientRect().top;
    const elementVisible = 150;
    if (elementTop < window.innerHeight - elementVisible) {
      element.classList.add('visible');
    }
  });
});
```

### 9.4 卡片翻转效果

```html
<div class="card">
  <div class="card-front">Front</div>
  <div class="card-back">Back</div>
</div>
```

```css
.card {
  width: 200px;
  height: 300px;
  perspective: 1000px;
  margin: 0 auto;
}

.card-front, .card-back {
  width: 100%;
  height: 100%;
  position: absolute;
  backface-visibility: hidden;
  transition: transform 0.6s ease;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 24px;
  font-weight: bold;
  border-radius: 8px;
}

.card-front {
  background-color: blue;
  color: white;
}

.card-back {
  background-color: red;
  color: white;
  transform: rotateY(180deg);
}

.card:hover .card-front {
  transform: rotateY(180deg);
}

.card:hover .card-back {
  transform: rotateY(0deg);
}
```

## 10. 总结

CSS动画与过渡是创建动态网页效果的重要工具，它们可以使网页更加生动、有趣，提升用户体验。过渡适用于简单的状态变化，而动画适用于更复杂的动画序列。

掌握CSS变换、过渡和动画的使用方法，以及性能优化技巧，对于创建高性能、流畅的动画效果至关重要。在实际开发中，应根据具体需求选择合适的动画方式，并遵循最佳实践，确保动画效果既美观又不影响性能。

随着CSS技术的不断发展，动画效果变得越来越丰富和强大，前端开发者应该不断学习和探索新的动画技术，创造出更好的用户体验。