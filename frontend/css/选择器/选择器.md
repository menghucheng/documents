# CSS 选择器

## 1. 基本选择器

### 1.1 元素选择器

元素选择器根据HTML元素名称匹配元素。

```css
h1 {
  color: red;
}
p {
  font-size: 16px;
}
```

### 1.2 类选择器

类选择器使用 `.` 符号后跟类名，匹配所有带有该类的元素。

```css
.container {
  width: 100%;
  margin: 0 auto;
}

.highlight {
  background-color: yellow;
}
```

### 1.3 ID选择器

ID选择器使用 `#` 符号后跟ID名，匹配具有该ID的唯一元素。

```css
#header {
  height: 100px;
  background-color: blue;
}

#main-content {
  padding: 20px;
}
```

### 1.4 通用选择器

通用选择器使用 `*` 符号，匹配文档中的所有元素。

```css
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
```

## 2. 组合选择器

### 2.1 后代选择器

后代选择器使用空格分隔两个选择器，匹配第一个选择器的所有后代元素中符合第二个选择器的元素。

```css
.container p {
  color: gray;
}

nav ul {
  list-style: none;
}
```

### 2.2 子元素选择器

子元素选择器使用 `>` 符号分隔两个选择器，匹配第一个选择器的直接子元素中符合第二个选择器的元素。

```css
.container > div {
  padding: 10px;
}

ul > li {
  display: inline-block;
}
```

### 2.3 相邻兄弟选择器

相邻兄弟选择器使用 `+` 符号分隔两个选择器，匹配第一个选择器后面紧跟的符合第二个选择器的兄弟元素。

```css
h1 + p {
  font-weight: bold;
  margin-top: 0;
}

input + button {
  margin-left: 10px;
}
```

### 2.4 通用兄弟选择器

通用兄弟选择器使用 `~` 符号分隔两个选择器，匹配第一个选择器后面所有符合第二个选择器的兄弟元素。

```css
h2 ~ p {
  color: green;
}

input:focus ~ .error-message {
  display: block;
}
```

## 3. 属性选择器

### 3.1 基本属性选择器

匹配具有指定属性的元素。

```css
[disabled] {
  opacity: 0.5;
  cursor: not-allowed;
}

[title] {
  border-bottom: 1px dotted blue;
}
```

### 3.2 属性值选择器

匹配具有指定属性和值的元素。

```css
[type="text"] {
  width: 200px;
  padding: 5px;
}

[class="active"] {
  color: red;
}
```

### 3.3 属性值包含选择器

匹配属性值包含指定字符串的元素。

```css
[class*="btn"] {
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
}

[data-info*="important"] {
  background-color: yellow;
}
```

### 3.4 属性值开头选择器

匹配属性值以指定字符串开头的元素。

```css
[href^="https"] {
  color: green;
}

[class^="col-"] {
  float: left;
}
```

### 3.5 属性值结尾选择器

匹配属性值以指定字符串结尾的元素。

```css
[href$=".pdf"] {
  color: red;
}

[src$=".jpg"], [src$=".png"] {
  max-width: 100%;
}
```

### 3.6 属性值空格分隔选择器

匹配属性值中包含指定单词（以空格分隔）的元素。

```css
[class~="active"] {
  font-weight: bold;
}

[data-tags~="featured"] {
  border: 2px solid blue;
}
```

## 4. 伪类选择器

### 4.1 状态伪类

匹配元素的特定状态。

```css
/* 链接状态 */
a:link {
  color: blue;
}
a:visited {
  color: purple;
}
a:hover {
  color: red;
  text-decoration: underline;
}
a:active {
  color: darkred;
}

/* 表单状态 */
input:focus {
  border: 2px solid blue;
  outline: none;
}
input:disabled {
  background-color: #f0f0f0;
}

/* 复选框状态 */
input:checked {
  accent-color: green;
}
```

### 4.2 结构伪类

根据元素在文档树中的位置匹配元素。

```css
/* 第一个子元素 */
li:first-child {
  font-weight: bold;
}

/* 最后一个子元素 */
li:last-child {
  margin-bottom: 0;
}

/* 第n个子元素 */
li:nth-child(2) {
  color: red;
}

/* 偶数位置子元素 */
li:nth-child(even) {
  background-color: #f0f0f0;
}

/* 奇数位置子元素 */
li:nth-child(odd) {
  background-color: #ffffff;
}

/* 倒数第n个子元素 */
li:nth-last-child(2) {
  color: blue;
}

/* 第一个特定类型的子元素 */
p:first-of-type {
  margin-top: 0;
}

/* 最后一个特定类型的子元素 */
p:last-of-type {
  margin-bottom: 0;
}

/* 第n个特定类型的子元素 */
p:nth-of-type(3) {
  color: green;
}

/* 只有一个子元素的元素 */
div:only-child {
  width: 100%;
}
```

### 4.3 否定伪类

匹配不满足指定条件的元素。

```css
/* 不是active类的元素 */
.button:not(.active) {
  opacity: 0.7;
}

/* 不是div的元素 */
:not(div) {
  margin: 5px;
}

/* 不是第一个子元素的li */
li:not(:first-child) {
  margin-top: 10px;
}
```

### 4.4 其他伪类

```css
/* 空元素 */
:empty {
  display: none;
}

/* 根元素 */
:root {
  --primary-color: blue;
}

/* 目标元素 */
:target {
  background-color: yellow;
}

/* 语言伪类 */
:lang(en) {
  font-family: Arial, sans-serif;
}
:lang(zh) {
  font-family: "Microsoft YaHei", sans-serif;
}
```

## 5. 伪元素选择器

### 5.1 ::before 和 ::after

在元素内容前后插入内容。

```css
/* 在段落前插入内容 */
p::before {
  content: "▶ ";
  color: blue;
}

/* 在链接后插入URL */
a[href]::after {
  content: " (" attr(href) ")";
  font-size: 0.8em;
  color: gray;
}

/* 清除浮动 */
.clearfix::after {
  content: "";
  display: table;
  clear: both;
}
```

### 5.2 ::first-line

匹配文本块的第一行。

```css
p::first-line {
  font-weight: bold;
  color: blue;
}

h1::first-line {
  font-size: 1.2em;
}
```

### 5.3 ::first-letter

匹配文本块的第一个字母。

```css
p::first-letter {
  font-size: 2em;
  font-weight: bold;
  color: red;
  float: left;
  margin-right: 5px;
}

blockquote::first-letter {
  font-size: 3em;
  color: blue;
}
```

### 5.4 ::selection

匹配用户选中的文本。

```css
::selection {
  background-color: yellow;
  color: black;
}

::-moz-selection {
  background-color: yellow;
  color: black;
}
```

### 5.5 ::placeholder

匹配表单元素的占位符文本。

```css
input::placeholder {
  color: gray;
  font-style: italic;
}

textarea::placeholder {
  color: gray;
  font-style: italic;
}
```

## 6. 选择器优先级

CSS选择器的优先级决定了当多个选择器应用于同一个元素时，哪个样式会被应用。优先级从高到低依次为：

1. **内联样式** - 在元素的style属性中定义的样式
2. **ID选择器** - 使用#id定义的样式
3. **类选择器、属性选择器、伪类选择器** - 使用.class、[attribute]、:pseudo-class定义的样式
4. **元素选择器、伪元素选择器** - 使用element、::pseudo-element定义的样式
5. **通用选择器** - 使用*定义的样式

### 6.1 优先级计算

优先级可以用一个四位数表示：[内联样式, ID选择器, 类/属性/伪类选择器, 元素/伪元素选择器]

```css
/* 优先级：0,0,0,1 */
h1 {
  color: red;
}

/* 优先级：0,0,1,0 */
.title {
  color: blue;
}

/* 优先级：0,1,0,0 */
#main-title {
  color: green;
}

/* 优先级：0,1,1,1 */
h1.title#main-title {
  color: purple;
}

/* 优先级：1,0,0,0 */
h1 style="color: orange;"
```

### 6.2 !important 规则

使用!important可以覆盖任何优先级的样式，但应尽量避免使用，因为它会破坏CSS的层叠规则。

```css
.title {
  color: blue !important;
}

#main-title {
  color: green; /* 不会生效，因为.title有!important */
}
```

## 7. 选择器最佳实践

### 7.1 保持选择器简洁

```css
/* 不好的做法 */
div.container > ul.nav > li.menu-item > a.link {
  color: blue;
}

/* 好的做法 */
.nav-link {
  color: blue;
}
```

### 7.2 避免过度使用ID选择器

ID选择器优先级高，难以覆盖，应尽量使用类选择器。

### 7.3 使用语义化的类名

```css
/* 不好的做法 */
.red-text {
  color: red;
}

/* 好的做法 */
.error-message {
  color: red;
}
```

### 7.4 避免使用!important

除非绝对必要，否则不要使用!important。

### 7.5 使用CSS变量提高可维护性

```css
:root {
  --primary-color: blue;
  --secondary-color: green;
}

.button {
  background-color: var(--primary-color);
  color: white;
}

.button.secondary {
  background-color: var(--secondary-color);
}
```

### 7.6 考虑性能

- 避免使用通用选择器*在大型文档中
- 避免过度使用后代选择器
- 优先使用类选择器，它们性能更好

## 8. 选择器示例

### 8.1 表单样式

```css
/* 所有表单元素 */
input, textarea, select {
  width: 100%;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

/* 聚焦状态 */
input:focus, textarea:focus, select:focus {
  outline: none;
  border-color: blue;
  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

/* 错误状态 */
input:invalid, textarea:invalid {
  border-color: red;
}

/* 必填字段 */
input:required, textarea:required {
  border-left: 3px solid orange;
}
```

### 8.2 表格样式

```css
/* 表格样式 */
table {
  width: 100%;
  border-collapse: collapse;
}

/* 表头样式 */
th {
  background-color: #f2f2f2;
  font-weight: bold;
  text-align: left;
}

/* 表格单元格样式 */
th, td {
  padding: 12px;
  border-bottom: 1px solid #ddd;
}

/* 奇偶行样式 */
tr:nth-child(even) {
  background-color: #f9f9f9;
}

/* 悬停行样式 */
tr:hover {
  background-color: #e9e9e9;
}
```

### 8.3 导航菜单样式

```css
/* 导航容器 */
.nav {
  list-style: none;
  padding: 0;
  margin: 0;
  background-color: #333;
}

/* 导航项 */
.nav li {
  display: inline-block;
}

/* 导航链接 */
.nav li a {
  display: block;
  color: white;
  text-decoration: none;
  padding: 14px 16px;
}

/* 导航链接悬停状态 */
.nav li a:hover {
  background-color: #111;
}

/* 当前页面导航链接 */
.nav li a.active {
  background-color: #4CAF50;
}

/* 下拉菜单 */
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

/* 下拉菜单链接 */
.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  text-align: left;
}

/* 下拉菜单链接悬停状态 */
.dropdown-content a:hover {
  background-color: #f1f1f1;
}

/* 显示下拉菜单 */
.dropdown:hover .dropdown-content {
  display: block;
}
```

## 9. 浏览器兼容性

大多数现代浏览器都支持CSS3选择器，但在使用一些高级选择器时，需要考虑旧版浏览器的兼容性。

### 9.1 兼容性表

| 选择器类型 | IE 8 | IE 9+ | Chrome | Firefox | Safari |
|------------|------|-------|--------|---------|--------|
| 基本选择器 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 组合选择器 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 属性选择器 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 伪类选择器 | ❌ | ✅ | ✅ | ✅ | ✅ |
| 伪元素选择器 | ✅ (单冒号) | ✅ | ✅ | ✅ | ✅ |

### 9.2 兼容性解决方案

1. **使用CSS前缀**：对于一些实验性的选择器，需要使用浏览器前缀。
2. **提供降级方案**：为不支持高级选择器的浏览器提供基本样式。
3. **使用CSS预处理器**：如Sass、Less等，可以自动处理兼容性问题。
4. **使用polyfill**：对于一些不支持的选择器，可以使用JavaScript polyfill。

## 10. 总结

CSS选择器是CSS的核心组成部分，它决定了样式规则应用到哪些元素上。掌握不同类型的选择器及其优先级，对于编写高效、可维护的CSS代码至关重要。

通过合理使用选择器，可以实现复杂的样式效果，同时保持代码的简洁性和可维护性。在实际开发中，应根据具体需求选择合适的选择器，并遵循最佳实践，以提高代码质量和性能。