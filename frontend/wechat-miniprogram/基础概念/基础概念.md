# 微信小程序基础概念

## 1. 微信小程序概述

微信小程序是腾讯于2017年1月9日推出的一种不需要下载安装即可使用的应用，它实现了"触手可及"的梦想，用户扫一扫或搜一下即可打开应用。

微信小程序基于微信平台运行，依托微信的庞大用户基数和生态系统，具有开发成本低、传播速度快、用户体验好等特点。

## 2. 微信小程序的主要特点

### 2.1 无需安装，即用即走
用户不需要下载安装即可使用小程序，降低了用户使用门槛，提高了用户转化率。

### 2.2 触手可及，用完即走
用户可以通过微信扫一扫、搜索、好友分享等多种方式快速访问小程序，使用完毕后无需关闭，自动回到微信，不占用手机内存。

### 2.3 基于微信平台，天然社交属性
小程序可以无缝集成微信的社交功能，如分享给好友、分享到群聊、生成分享海报等，便于传播和推广。

### 2.4 开发成本低，周期短
小程序使用类似HTML、CSS、JavaScript的语法开发，学习成本低，开发周期短，适合快速迭代和试错。

### 2.5 跨平台兼容
小程序一次开发，可在iOS和Android平台上运行，无需针对不同平台分别开发。

### 2.6 丰富的API和组件
微信提供了丰富的API和组件，开发者可以方便地调用微信的各种功能，如支付、地理位置、摄像头、蓝牙等。

## 3. 微信小程序的架构

### 3.1 整体架构

微信小程序采用**双线程模型**架构：

- **渲染层**：使用WebView渲染页面，负责页面的展示和交互
- **逻辑层**：使用JavaScriptCore执行JavaScript代码，负责业务逻辑处理

两个线程通过微信客户端进行通信，确保了小程序的安全性和性能。

### 3.2 核心框架

小程序的核心框架包括：

- **WXML**：类似HTML的标记语言，用于描述页面结构
- **WXSS**：类似CSS的样式语言，用于描述页面样式
- **JavaScript**：用于实现页面逻辑
- **JSON**：用于配置页面和小程序

## 4. 微信小程序的文件结构

### 4.1 项目结构

一个典型的微信小程序项目包含以下文件和目录：

```
my-miniprogram/
├── app.js              # 小程序入口文件
├── app.json            # 小程序全局配置
├── app.wxss            # 小程序全局样式
├── pages/              # 页面目录
│   ├── index/          # 首页
│   │   ├── index.js    # 页面逻辑
│   │   ├── index.json  # 页面配置
│   │   ├── index.wxml  # 页面结构
│   │   └── index.wxss  # 页面样式
│   └── logs/           # 日志页面
│       ├── logs.js
│       ├── logs.json
│       ├── logs.wxml
│       └── logs.wxss
├── components/         # 自定义组件目录
├── utils/             # 工具函数目录
└── assets/            # 静态资源目录
    ├── images/        # 图片资源
    └── fonts/         # 字体资源
```

### 4.2 文件类型说明

| 文件类型 | 扩展名 | 用途 |
|---------|-------|------|
| 配置文件 | .json | 用于配置小程序和页面 |
| 页面结构 | .wxml | 类似HTML，描述页面结构 |
| 页面样式 | .wxss | 类似CSS，描述页面样式 |
| 页面逻辑 | .js | 用于实现页面逻辑 |

### 4.3 核心文件详解

#### 4.3.1 app.json

全局配置文件，用于配置小程序的页面路径、窗口样式、导航栏样式、底部标签栏等。

```json
{
  "pages": [
    "pages/index/index",
    "pages/logs/logs"
  ],
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#fff",
    "navigationBarTitleText": "我的小程序",
    "navigationBarTextStyle": "black"
  },
  "tabBar": {
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "首页",
        "iconPath": "assets/images/home.png",
        "selectedIconPath": "assets/images/home-active.png"
      },
      {
        "pagePath": "pages/logs/logs",
        "text": "日志",
        "iconPath": "assets/images/logs.png",
        "selectedIconPath": "assets/images/logs-active.png"
      }
    ]
  },
  "networkTimeout": {
    "request": 10000,
    "downloadFile": 10000
  },
  "debug": true
}
```

#### 4.3.2 app.js

小程序的入口文件，用于初始化小程序实例，监听生命周期事件。

```javascript
App({
  onLaunch: function() {
    // 小程序启动时执行
    console.log('小程序启动');
  },
  onShow: function() {
    // 小程序显示时执行
    console.log('小程序显示');
  },
  onHide: function() {
    // 小程序隐藏时执行
    console.log('小程序隐藏');
  },
  globalData: {
    userInfo: null,
    appId: 'wx1234567890abcdef'
  }
});
```

#### 4.3.3 app.wxss

全局样式文件，用于定义小程序的全局样式，所有页面都可以使用。

```css
/* 全局样式 */
.container {
  padding: 20rpx;
  font-size: 28rpx;
  line-height: 1.5;
  color: #333;
  background-color: #f5f5f5;
}

/* 全局字体 */
@font-face {
  font-family: 'CustomFont';
  src: url('assets/fonts/custom-font.ttf');
}
```

## 5. 微信小程序的开发流程

### 5.1 开发前准备

1. **注册微信公众平台账号**
   - 访问 [微信公众平台](https://mp.weixin.qq.com/) 注册账号
   - 选择小程序类型

2. **获取AppID**
   - 在微信公众平台获取小程序的AppID
   - AppID是小程序的唯一标识，用于开发和发布

3. **下载微信开发者工具**
   - 访问 [微信开发者工具下载页面](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html) 下载对应平台的开发者工具

### 5.2 开发步骤

1. **创建项目**
   - 打开微信开发者工具
   - 点击"新建项目"
   - 填写项目名称、目录、AppID等信息
   - 选择项目模板（如"不使用模板"、"JavaScript基础模板"等）

2. **编写代码**
   - 编写WXML文件，构建页面结构
   - 编写WXSS文件，设置页面样式
   - 编写JavaScript文件，实现页面逻辑
   - 编写JSON文件，配置页面和小程序

3. **调试和预览**
   - 在微信开发者工具中调试代码
   - 使用模拟器预览效果
   - 使用真机调试，在手机上查看效果

4. **提交审核**
   - 完成开发和测试后，提交代码审核
   - 审核通过后，小程序即可发布上线

5. **发布上线**
   - 审核通过后，在微信公众平台发布小程序
   - 小程序发布后，用户即可通过微信搜索或扫码访问

## 6. 微信小程序的核心概念

### 6.1 页面生命周期

小程序页面有自己的生命周期，主要包括：

| 生命周期函数 | 描述 |
|------------|------|
| `onLoad` | 页面加载时执行，只执行一次 |
| `onShow` | 页面显示时执行，每次打开页面都会执行 |
| `onReady` | 页面初次渲染完成时执行，只执行一次 |
| `onHide` | 页面隐藏时执行 |
| `onUnload` | 页面卸载时执行 |

```javascript
Page({
  onLoad: function(options) {
    // 页面加载，options为页面参数
    console.log('页面加载', options);
  },
  onShow: function() {
    // 页面显示
    console.log('页面显示');
  },
  onReady: function() {
    // 页面初次渲染完成
    console.log('页面渲染完成');
  },
  onHide: function() {
    // 页面隐藏
    console.log('页面隐藏');
  },
  onUnload: function() {
    // 页面卸载
    console.log('页面卸载');
  }
});
```

### 6.2 数据绑定

小程序使用类似Vue的双向数据绑定机制，通过`{{}}`语法将数据绑定到WXML页面。

```wxml
<!-- index.wxml -->
<view class="container">
  <text>{{message}}</text>
  <input type="text" bindinput="onInput" value="{{message}}" />
  <button bindtap="onTap" type="primary">点击按钮</button>
</view>
```

```javascript
// index.js
Page({
  data: {
    message: 'Hello 小程序'
  },
  onInput: function(e) {
    // 更新数据
    this.setData({
      message: e.detail.value
    });
  },
  onTap: function() {
    // 修改数据
    this.setData({
      message: '按钮被点击了'
    });
  }
});
```

### 6.3 事件处理

小程序使用`bind`或`catch`关键字绑定事件，`bind`事件会冒泡，`catch`事件会阻止冒泡。

| 事件类型 | 描述 |
|---------|------|
| `tap` | 点击事件 |
| `input` | 输入事件 |
| `change` | 改变事件 |
| `confirm` | 确认事件 |
| `longpress` | 长按事件 |
| `scroll` | 滚动事件 |

### 6.4 导航

小程序提供了多种导航方式：

#### 6.4.1 声明式导航

使用`<navigator>`组件实现导航：

```wxml
<!-- 跳转到新页面 -->
<navigator url="/pages/detail/detail?id=1">查看详情</navigator>

<!-- 重定向 -->
<navigator url="/pages/login/login" open-type="redirect">登录</navigator>

<!-- 返回上一页 -->
<navigator open-type="navigateBack" delta="1">返回</navigator>
```

#### 6.4.2 编程式导航

使用`wx.navigateTo`、`wx.redirectTo`、`wx.navigateBack`等API实现导航：

```javascript
// 跳转到新页面
wx.navigateTo({
  url: '/pages/detail/detail?id=1'
});

// 重定向
wx.redirectTo({
  url: '/pages/login/login'
});

// 返回上一页
wx.navigateBack({
  delta: 1
});
```

### 6.5 网络请求

小程序使用`wx.request` API发送网络请求：

```javascript
wx.request({
  url: 'https://api.example.com/data',
  method: 'GET',
  data: {
    page: 1,
    limit: 10
  },
  header: {
    'content-type': 'application/json'
  },
  success: function(res) {
    console.log('请求成功', res.data);
  },
  fail: function(err) {
    console.error('请求失败', err);
  },
  complete: function() {
    console.log('请求完成');
  }
});
```

## 7. 微信小程序与传统Web应用的区别

| 特性 | 微信小程序 | 传统Web应用 |
|------|----------|------------|
| 运行环境 | 微信客户端（双线程模型） | 浏览器（单线程） |
| 开发语言 | WXML、WXSS、JavaScript | HTML、CSS、JavaScript |
| 渲染方式 | WebView渲染 | 浏览器渲染 |
| API调用 | 微信提供的API | 浏览器API |
| 缓存机制 | 小程序缓存 | 浏览器缓存（Cookie、LocalStorage等） |
| 发布方式 | 微信公众平台审核发布 | 任意服务器部署 |
| 用户访问 | 微信扫码或搜索 | 浏览器输入URL |
| 性能 | 接近原生应用 | 依赖网络和浏览器性能 |
| 安全性 | 微信严格控制 | 取决于服务器和前端安全措施 |

## 8. 总结

微信小程序是一种基于微信平台的轻量级应用，具有无需安装、即用即走、开发成本低、传播速度快等特点。

小程序采用双线程模型架构，使用WXML、WXSS、JavaScript和JSON开发，提供了丰富的API和组件，便于开发者快速构建高质量的应用。

掌握微信小程序的基础概念和开发流程，对于开发小程序应用至关重要。通过不断学习和实践，开发者可以开发出功能丰富、体验良好的小程序应用。